SELECT
    CAB.CODVEND,
    VEND.APELIDO              AS VENDEDOR,

    CAB.CODUSUINC             AS CODUSU,
    USU.NOMEUSU               AS NOMEUSU,

    CAB.CODTIPOPER,
    TGFTOP.DESCROPER             AS DESCRICAO_TGFTOP,

    COUNT(CAB.NUNOTA)         AS QTD_PEDIDOS,
    SUM(CAB.VLRNOTA)          AS VALOR_TOTAL
FROM
    SANKHYA.TGFCAB CAB
    JOIN SANKHYA.TGFVEN VEND
        ON CAB.CODVEND = VEND.CODVEND
    JOIN SANKHYA.TSIUSU USU
        ON CAB.CODUSUINC = USU.CODUSU
    LEFT JOIN SANKHYA.TGFTOP TGFTOP
        ON CAB.CODTIPOPER = TGFTOP.CODTIPOPER
WHERE
    CAB.TIPMOV = 'O'
    AND CAB.STATUSNOTA = 'L'
    AND CAB.DTMOV BETWEEN '2025-01-01' AND '2025-12-31'
    AND CAB.CODTIPOPER NOT IN (2,3,113,132,133)
GROUP BY
    CAB.CODVEND,
    VEND.APELIDO,
    CAB.CODUSUINC,
    USU.NOMEUSU,
    CAB.CODTIPOPER,
    TGFTOP.DESCROPER
ORDER BY
    CAB.CODVEND,
    CAB.CODUSUINC,
    CAB.CODTIPOPER;
