-- Query de movimentações que apresentou erro na API Sankhya
SELECT
  PRO.CODGRUPOPROD as codigo,
  GRU.DESCRGRUPOPROD as descricao,
  ITE.ATUALESTOQUE as tipo_movimento,
  COUNT(*) as qtd_movimentacoes,
  SUM(ITE.QTDNEG) as total_qtd
FROM TGFITE ITE
  JOIN TGFCAB CAB ON ITE.NUNOTA = CAB.NUNOTA
  JOIN TGFPRO PRO ON ITE.CODPROD = PRO.CODPROD
  LEFT JOIN TGFGRU GRU ON PRO.CODGRUPOPROD = GRU.CODGRUPOPROD
WHERE PRO.CODGRUPOPROD IN (20101,20102,20103,20104,20105,20106,20107,20108)
  AND CAB.STATUSNOTA = 'L'
  AND CAB.DTMOV BETWEEN '2025-01-01' AND '2026-01-02'
GROUP BY PRO.CODGRUPOPROD, GRU.DESCRGRUPOPROD, ITE.ATUALESTOQUE
ORDER BY PRO.CODGRUPOPROD, ITE.ATUALESTOQUE;

-- Versão com datas mais amplas
SELECT
  PRO.CODGRUPOPROD as codigo,
  GRU.DESCRGRUPOPROD as descricao,
  ITE.ATUALESTOQUE as tipo_movimento,
  COUNT(*) as qtd_movimentacoes,
  SUM(ITE.QTDNEG) as total_qtd
FROM TGFITE ITE
  JOIN TGFCAB CAB ON ITE.NUNOTA = CAB.NUNOTA
  JOIN TGFPRO PRO ON ITE.CODPROD = PRO.CODPROD
  LEFT JOIN TGFGRU GRU ON PRO.CODGRUPOPROD = GRU.CODGRUPOPROD
WHERE PRO.CODGRUPOPROD IN (20101,20102,20103,20104,20105,20106,20107,20108)
  AND CAB.STATUSNOTA = 'L'
  AND CAB.DTMOV BETWEEN '2020-01-01' AND '2026-01-02'
GROUP BY PRO.CODGRUPOPROD, GRU.DESCRGRUPOPROD, ITE.ATUALESTOQUE
ORDER BY PRO.CODGRUPOPROD, ITE.ATUALESTOQUE;

-- Versão sem filtro de grupo
SELECT
  PRO.CODGRUPOPROD as codigo,
  GRU.DESCRGRUPOPROD as descricao,
  ITE.ATUALESTOQUE as tipo_movimento,
  COUNT(*) as qtd_movimentacoes,
  SUM(ITE.QTDNEG) as total_qtd
FROM TGFITE ITE
  JOIN TGFCAB CAB ON ITE.NUNOTA = CAB.NUNOTA
  JOIN TGFPRO PRO ON ITE.CODPROD = PRO.CODPROD
  LEFT JOIN TGFGRU GRU ON PRO.CODGRUPOPROD = GRU.CODGRUPOPROD
WHERE CAB.STATUSNOTA = 'L'
  AND CAB.DTMOV BETWEEN '2020-01-01' AND '2026-01-02'
GROUP BY PRO.CODGRUPOPROD, GRU.DESCRGRUPOPROD, ITE.ATUALESTOQUE
ORDER BY PRO.CODGRUPOPROD, ITE.ATUALESTOQUE;

-- Versão sem filtro de data
SELECT
  PRO.CODGRUPOPROD as codigo,
  GRU.DESCRGRUPOPROD as descricao,
  ITE.ATUALESTOQUE as tipo_movimento,
  COUNT(*) as qtd_movimentacoes,
  SUM(ITE.QTDNEG) as total_qtd
FROM TGFITE ITE
  JOIN TGFCAB CAB ON ITE.NUNOTA = CAB.NUNOTA
  JOIN TGFPRO PRO ON ITE.CODPROD = PRO.CODPROD
  LEFT JOIN TGFGRU GRU ON PRO.CODGRUPOPROD = GRU.CODGRUPOPROD
WHERE CAB.STATUSNOTA = 'L'
GROUP BY PRO.CODGRUPOPROD, GRU.DESCRGRUPOPROD, ITE.ATUALESTOQUE
ORDER BY PRO.CODGRUPOPROD, ITE.ATUALESTOQUE;

-- Versão sem filtro de status
SELECT
  PRO.CODGRUPOPROD as codigo,
  GRU.DESCRGRUPOPROD as descricao,
  ITE.ATUALESTOQUE as tipo_movimento,
  COUNT(*) as qtd_movimentacoes,
  SUM(ITE.QTDNEG) as total_qtd
FROM TGFITE ITE
  JOIN TGFCAB CAB ON ITE.NUNOTA = CAB.NUNOTA
  JOIN TGFPRO PRO ON ITE.CODPROD = PRO.CODPROD
  LEFT JOIN TGFGRU GRU ON PRO.CODGRUPOPROD = GRU.CODGRUPOPROD
GROUP BY PRO.CODGRUPOPROD, GRU.DESCRGRUPOPROD, ITE.ATUALESTOQUE
ORDER BY PRO.CODGRUPOPROD, ITE.ATUALESTOQUE;

-- Versão sem nenhum filtro (pode ser pesada)
SELECT
  PRO.CODGRUPOPROD as codigo,
  GRU.DESCRGRUPOPROD as descricao,
  ITE.ATUALESTOQUE as tipo_movimento,
  COUNT(*) as qtd_movimentacoes,
  SUM(ITE.QTDNEG) as total_qtd
FROM TGFITE ITE
  JOIN TGFCAB CAB ON ITE.NUNOTA = CAB.NUNOTA
  JOIN TGFPRO PRO ON ITE.CODPROD = PRO.CODPROD
  LEFT JOIN TGFGRU GRU ON PRO.CODGRUPOPROD = GRU.CODGRUPOPROD
GROUP BY PRO.CODGRUPOPROD, GRU.DESCRGRUPOPROD, ITE.ATUALESTOQUE
ORDER BY PRO.CODGRUPOPROD, ITE.ATUALESTOQUE;

-- Versão para testar outros status
SELECT DISTINCT CAB.STATUSNOTA
FROM TGFCAB;
